{"hash":"0d11980d340843b64c9cb4c82a2c216fb1076a15","data":{"modelThreatsPost":{"title":"ZIPSLIP","path":"/model-threats/zipslip/","content":"<h2 id=\"overview\"><a href=\"#overview\" aria-hidden=\"true\" tabindex=\"-1\">Overview</a></h2>\n<p>A Zip-based model may contain path-traversal file entries, which may lead to <strong>arbitrary file overwrite</strong> when interacting with the model.</p>\n<p>Many ML models such as Keras v3, PyTorch and MLeap come serialized as a ZIP archive. </p>\n<p>As part of standard usage with these models, the model library may extract some or all of the files from the ZIP archive.</p>\n<p>The ZIP format in general is potentially vulnerable to a path traversal attack nicknamed \"Zip Slip\" where some zip file entries can point to path <strong>outside of the intended extraction directory</strong>. This is usually achieved in one of two ways -</p>\n<ol>\n<li>A file entry that contains path traversal characters, such as - <code>../../../../../etc/passwd</code></li>\n<li>A file entry that contains a symbolic link</li>\n</ol>\n<p>When vulnerable libraries extract these file entries, the file is extracted outside of the intended extraction directory and can overwrite critical system files, in the worst case leading to arbitrary code execution.</p>\n<p>As demonstrated in <a href=\"https://research.jfrog.com/vulnerabilities/mleap-path-traversal-rce-xray-532656/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CVE-2023-5245</a>, some Zip-based models are indeed vulnerable to the \"Zip Slip\" attack, therefore each Zip-based model should be inspected for malicious file entries before it is loaded and queried.</p>\n<p>It is extremely easy for attackers to generate \"Zip Slip\" payloads with automated public tools such as <a href=\"https://github.com/ptoomey3/evilarc/tree/master\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">evilarc</a>.</p>\n<h2 id=\"time-of-infection\"><a href=\"#time-of-infection\" aria-hidden=\"true\" tabindex=\"-1\">Time of Infection</a></h2>\n<p>[] Model Load</p>\n<p><strong>[v] Model Query</strong></p>\n<p>[] Other</p>\n<h2 id=\"evidence-extraction-and-false-positive-elimination\"><a href=\"#evidence-extraction-and-false-positive-elimination\" aria-hidden=\"true\" tabindex=\"-1\">Evidence Extraction and False Positive Elimination</a></h2>\n<p>To safely determine if the suspected zip archive contains malicious entries with path traversal characters,  it is possible to employ a detection similar to the following Python code snippet -</p>\n<pre><code class=\"language-python\">import zipfile\nimport os\n\ndef is_zip_slip_archive(zip_path):\n    \"\"\"\n    Checks if a ZIP file contains files with path traversal sequences.\n    :param zip_path: Path to the ZIP file.\n    :return: True if the ZIP contains malicious paths, otherwise False.\n    \"\"\"\n    try:\n        with zipfile.ZipFile(zip_path, 'r') as zip_file:\n            for fpath in zip_file.namelist():\n                # Check if the path attempts to escape the intended directory\n                if fpath.startswith(\"..\") or \"../\" in fpath:\n                    print(f\"Potential Zip Slip vulnerability detected: {fpath}\")\n                    return True            \n    except zipfile.BadZipFile:\n        print(\"Error: Not a valid ZIP file.\")\n        return False\n    \n    print(\"No Zip Slip vulnerability detected.\")\n    return False\n</code></pre>\n<p>JFrog conducts detailed analysis on each Zip-based model in order to determine whether any malicious file entries are present.</p>\n<h2 id=\"additional-information\"><a href=\"#additional-information\" aria-hidden=\"true\" tabindex=\"-1\">Additional Information</a></h2>\n<ul>\n<li><a href=\"https://jfrog.com/blog/machine-learning-bug-bonanza-exploiting-ml-clients-and-safe-models/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://jfrog.com/blog/machine-learning-bug-bonanza-exploiting-ml-clients-and-safe-models/</a></li>\n</ul>\n","description":"Zip-based model attempting ZipSlip path traversal"}},"context":{}}