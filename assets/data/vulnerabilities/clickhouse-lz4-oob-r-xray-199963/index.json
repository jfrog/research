{"hash":"9ae22a669738a956bcf46706b6d57d081285f743","data":{"post":{"title":"ClickHouse LZ4 OOB-R","path":"/vulnerabilities/clickhouse-lz4-oob-r-xray-199963/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>A heap out-of-bounds read in ClickHouse can allow an authenticated network attacker to perform information leakage and denial of service</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://clickhouse.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ClickHouse</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>ClickHouse (, 21.10.2.15), fixed in 21.10.2.15</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>A low-privileged authenticated network attacker can trigger this issue by sending crafted LZ4 data in a decompression request.</p>\n<p>Accessing memory outside of the buffer’s bounds can expose sensitive information or lead in certain cases to a crash of the application due to segmentation fault.</p>\n<p>As part of the <code>LZ4::decompressImpl() loop</code>, a 16-bit unsigned user-supplied value (<code>offset</code>) is read from the <code>compressed_data</code>. it is subtracted from the current op and stored in match pointer (op is a pointer that starts as dest and moves forward). There is no verification that the match pointer is not smaller than dest. Later, there’s a copy operation from match to output pointer - possibly copying out of bounds memory from before the <code>dest</code> memory buffer.</p>\n<p>CVE-2021-42388 is a similar vulnerability to CVE-2021-42387, which exceeds the lower bounds of the compressed buffer (source) as part of the copy operation.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>No PoC is supplied for this issue</p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No mitigations are provided for this vulnerability.</p>\n<p>In order to fully fix this vulnerability, we recommend upgrading ClickHouse to version 21.10.2.15.</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://jfrog.com/blog/7-rce-and-dos-vulnerabilities-found-in-clickhouse-dbms\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(JFrog) Security Vulnerabilities Found in ClickHouse Open-Source Software</a></p>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2021-42387\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2021-42387 Medium severity. Heap OOB-R in ClickHouse leads to information leakage and denial of service","date_published":"2022-03-15","xray_id":"XRAY-199963","vul_id":"CVE-2021-42387","severity":"medium","discovered_by":"Uriya Yavnieli","last_updated":"2022-03-15","cvss":7.1}},"context":{}}