{"hash":"2a486cb6c231bb91dbb9d2aebf0ee539829d215d","data":{"post":{"title":"libmodbus MODBUS_FC_WRITE_MULTIPLE_REGISTERS OOB-R","path":"/vulnerabilities/libmodbus-modbus-fc-write-multiple-registers-oob-r-xray-150046/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>Insufficient input validation in the libmodbus library allows unprivileged local network attackers to cause data leakage by sending simple crafted packets.</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://libmodbus.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">libmodbus</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>libmodbus [3.0.0,3.0.7), fixed on 3.0.7</p>\n<p>libmodbus [3.1.0,3.1.5), fixed on 3.1.5</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p><a href=\"https://libmodbus.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">libmodbus</a> is a C library that provides an implementation of the <a href=\"https://en.wikipedia.org/wiki/Modbus\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Modbus</a> protocol. It runs on Linux, Windows, FreeBSD, OS X, and QNX, and it is widely used in embedded devices.</p>\n<p>Attackers can trigger the exploit by invoking the <a href=\"https://libmodbus.org/docs/v3.1.6/modbus_write_registers.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">modbus_write_registers(3)</a> function (which implements the Modbus <a href=\"https://www.modbustools.com/modbus.html#function16\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Write Multiple Registers</a> protocol call) while specifying a large number of registers to be written. Since the code takes this parameter from the network packet without checking it for validity against the length of the provided payload, the attackers can specify a large enough number to cause memory overwrites. Memory contents directly following the payload will be saved to Modbus register units. These contents can be later read out using the <a href=\"https://libmodbus.org/docs/v3.1.6/modbus_read_registers.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">modbus_read_registers()</a> function. This results in a memory exfiltration vulnerability, exposing arbitrary memory contents.</p>\n<p>The attacker must be on the same network segment as the target device, limiting the potential for this attack.</p>\n<p>The library implementation of the <code>modbus_reply()</code> function of  module <code>src/modbus.c</code> module does not check properly that the number of registers/coils to be written corresponds to the the size of the provided payload data.</p>\n<p>The original exploit was developed by JFrog researches, using smart fuzzing on the library compiled separately from the rest of the code. There is another CVE (CVE-2019-14462) for this library, for the <code>modbus_write_bits</code> function.</p>\n<p>The official solution (see commits <a href=\"https://github.com/stephane/libmodbus/commit/5ccdf5ef79d742640355d1132fa9e2abc7fbaefc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">1</a> and <a href=\"https://github.com/stephane/libmodbus/commit/6f915d4215c06be3c719761423d9b5e8aa3cb820\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">2</a>) fixes the bug by adding code to check for the correspondence between the number of the registers to be written and the data provided in the payload.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>No PoC is supplied for this issue</p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No vulnerability mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2019-14463\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2019-14463\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2019-14463 Critical severity. Insufficient input validation in the libmodbus library allows unprivileged local network attackers to cause data leakage by sending simple crafted packets.","date_published":"2019-07-31","xray_id":"XRAY-150046","vul_id":"CVE-2019-14463","severity":"critical","discovered_by":"Maor Vermucht","last_updated":"2019-07-31","cvss":9.1}},"context":{}}