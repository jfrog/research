{"hash":"ccf6338d8d38a0184e25ea04f0c76bf3e2e9b820","data":{"post":{"title":"QCMAP Web Interface RCE","path":"/vulnerabilities/qcmap-web-interface-rce-xray-194063/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>Command injection and stack overflow in the Qualcomm QCMAP Web Interface leads to remote code execution</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p>Qualcomm QCMAP (closed source)</p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>QCMAP before October 2020</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>Remote code execution can happen by sending a carefully crafted POST query when Device configuration is accessed from a tethered client through webserver due to lack of array bound check.</p>\n<p>The issue resides in the <code>QCMAP_ConnectionManager</code> binary.</p>\n<p>Part of the basic functionality of the media server is to allow the user to set media directories to publish from. This can be done, for example, via the web interface.</p>\n<p>At the implementation level, the CGI handler at <code>cgi-bin/qcmap_web_cgi</code> passes data from the web form to the <code>QCMAP_Web_CLIENT</code> binary which parses the request. The sent data is expected to be in the format <code>var1=val1&#x26;var2=val2&#x26; var3=val3…</code>. The first variable is expected to be the <code>page</code> variable. If it is set to <code>SetMediaDir</code> the code parses the next variables to set the DLNA media directory. It then sends the variables to the <code>QCMAP_ConnectionManager</code> binary, which takes care of the request in the function <code>qmi_qcmap_msgr_set_dlna_media_dir</code> and passes it to <code>QCMAP_MediaService::SetDLNAMediaDir</code>. In this function, the code splits the sent directory by the <code>,</code> character, and for each portion, it calls <code>snprintf</code> to create a command, which is then sent as an argument to the <code>system</code> function. There is no check on the user input to make sure that it doesn’t include malicious characters, thus it is possible to pass a string with shell metacharacters (such as <code>;</code>) and run arbitrary commands.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p><code>http://x.x.x.x/cgi-bin/qcmap_web_cgi?page=SetMediaDir&#x26;dir=fakedir;sleep%2010</code></p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability mitigations</a></h2>\n<p>No vulnerability mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://jfrog.com/blog/major-vulnerabilities-discovered-in-qualcomm-qcmap/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(JFrog) Vulnerabilities Discovered in Qualcomm QCMAP enable remote root access</a></p>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-3657\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2020-3657 Critical severity. Command injection and stack overflow in the Qualcomm QCMAP Web Interface leads to remote code execution","date_published":"2020-10-14","xray_id":"XRAY-194063","vul_id":"CVE-2020-3657","severity":"critical","discovered_by":"Ori Hollander","last_updated":"2020-10-14","cvss":9.8}},"context":{}}