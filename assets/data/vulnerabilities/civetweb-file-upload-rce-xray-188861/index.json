{"hash":"f6ba0e664de50d9a421f9fb6edec25fc15fa64b4","data":{"post":{"title":"CivetWeb file upload RCE","path":"/vulnerabilities/civetweb-file-upload-rce-xray-188861/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>A path traversal in CivetWeb leads to remote code execution when an attacker uploads a maliciously-named file</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://github.com/civetweb/civetweb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CivetWeb</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>CivetWeb [1,8,1.14], fixed in 1.15</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p><a href=\"https://github.com/civetweb/civetweb\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">CivetWeb</a> is a very popular embeddable web server/library that can either be used standalone or by adding web server functionality to an existing application. CivetWeb prioritizes simplicity, customizability and performance. It can also be used by end users as a stand-alone web server running on a Windows or Linux PC.</p>\n<p>A path traversal issue was discovered, when accepting unsanitized filenames as part of a file upload operation.</p>\n<p>This issue only impacts CivetWeb-based web applications that use the built-in file upload form handler.\nIn technical terms, a CivetWeb-based web application is vulnerable if:</p>\n<ol>\n<li>The application handles HTTP form data by calling CivetWeb’s\n<code>mg_handle_form_request</code> and supplies the (mandatory) user-defined\n<code>field_found</code> callback function</li>\n<li>The <code>field_found</code> callback function returns <code>MG_FORM_FIELD_STORAGE_STORE</code> to indicate a file upload operation</li>\n<li>The <code>field_found</code> callback function supplies the (mandatory) <code>path</code> output argument, where the path relies on the <code>filename</code> input argument (which comes directly from the HTTP form data)</li>\n</ol>\n<p>Note that this scenario is the standard way of using CivetWeb’s file upload functionality, and is supplied as a full working example in the <a href=\"https://github.com/civetweb/civetweb/blob/0a39165041fd3f060187914e869eeaa78f864d0f/examples/embedded_c/embedded_c.c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">embedded_c</a> example in the CivetWeb sources.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>No PoC is supplied for this issue</p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>Use a WAF to filter HTTP form file upload requests that contain the string <code>..</code> in the <code>filename</code> form parameter</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://jfrog.com/blog/cve-2020-27304-rce-via-directory-traversal-in-civetweb-http-server/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(JFrog) Directory Traversal Vulnerability Found in CivetWeb </a></p>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-27304\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2020-27304  critical severity. A path traversal in CivetWeb leads to remote code execution when an attacker uploads a maliciously-named file","date_published":"2021-10-19","xray_id":"XRAY-188861","vul_id":"CVE-2020-27304","severity":"critical","discovered_by":"Denys Vozniuk","last_updated":"2021-10-19","cvss":9.8}},"context":{}}