{"hash":"93f2a86f47337a4564cd1c88837b44a50e321439","data":{"post":{"title":"PeerTube ActivityPub Playlist Creation Blind SSRF and DoS","path":"/vulnerabilities/peertube-activitypub-playlist-creation-blind-ssrf-dos/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>This vulnerability allows any attacker to cause the server to stop functioning, or in special cases send requests to arbitrary URLs (Blind SSRF).</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://github.com/Chocobozzz/PeerTube\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PeerTube</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>(, 7.1.0]</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>If federation is enabled (which is the default), PeerTube listens for POST requests to the <strong>/inbox</strong> path. This path is used for receiving ActivityPub activities. One of the possible activities is the Create Activity, which creates different objects on the server. One of the objects that may be created is a playlist. Part of the parsing of playlist ActivityPub objects includes fetching the playlist elements. The function that gets the list of the playlist items to fetch is <strong>fetchElementUrls</strong>. It is called from <strong>createOrUpdateVideoPlaylist</strong>. Afterwards, the <strong>rebuildVideoPlaylistElements</strong> function is called, which in turn calls the <strong>buildElementsDBAttributes</strong>, that calls <strong>fetchRemotePlaylistElement</strong> for each element. If the activity has an object instead of a string in the <strong>url</strong> field, the object will eventually be passed into the <strong>got</strong> library that is used by PeerTube, and will be parsed as additional options for the fetch. If the object will have valid options, they will be used by the <strong>got</strong> libraries. Such an example could be <strong>{“enableUnixSockets”: true, “url”: “unix:/….”}</strong>, which will cause the library to fetch from a UNIX socket (which won’t be protected by the <strong>got-ssrf</strong> library). Also the HTTP method can be changed, and some other options. In the case that the key isn’t valid, an error will be thrown, and will later be thrown again by the <strong>_destroy</strong> function in <strong>got</strong>, and will not be caught, causing the server to crash.</p>\n<p>It is also possible to trigger the attack by causing the server to actively fetch activities from a remote server. This can be done in different ways, for example by using the <strong>/api/v1/search/video-channels</strong> path, and passing the <strong>search</strong> argument with a URL that can be used for the attack. This can be done only if users have the ability to search remote URIs (<strong>search.remote_uri</strong> in the configuration), which by default is enabled for registered users.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>This PoC assumes that there is a PeerTube instance on the machine listening on ports 3000 (client) and 9000 (server). We also assume that there are 2 existing users on the instance: the default root user and a low privileged user.</p>\n<ol>\n<li>First, using a browser, log in to the PeerTube instance with the low privileged user’s credentials, and use the inspection screen to copy the authorization token of the user.</li>\n<li>\n<p>In a terminal, run the following command (you will need to install the <strong>flask</strong> package for python if it is not installed on the system):</p>\n<pre><code>python malicious_rest_server.py\n</code></pre>\n<p>This will start a server listening on port 1234.</p>\n</li>\n<li>\n<p>In another terminal, run the following command (insert the user token in the proper place):</p>\n<pre><code>curl -v 'http://localhost:3000/api/v1/search/video-channels?search=http://localhost:1234/accounts/root_crash' -H 'Authorization: Bearer user_token'\n</code></pre>\n<p>This technique is based on PeerTube’s search for channels. After fetching the outbox of a user, it will not be possible to ask for the same user again using this technique until the refresh interval will pass. This means that every time you want to run this curl command you should change something in the username (for example <code>http://localhost:1234/accounts/root1_crash</code> instead of <code>http://localhost:1234/accounts/root_crash</code>) .</p>\n</li>\n</ol>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://github.com/Chocobozzz/PeerTube/releases/tag/v7.1.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fix release</a></p>\n<p><a href=\"https://drive.google.com/file/d/1zmXFNutT4ACOJZGmxhU22nhu9Fbn4ui2/view?usp=drive_link\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PoC Materials</a></p>\n","description":"CVE-2025-32948 High severity. PeerTube ActivityPub Playlist Creation Blind SSRF and DoS","date_published":"2025-04-14","xray_id":"","vul_id":"CVE-2025-32948","severity":"high","discovered_by":"Ori Hollander","last_updated":"2025-04-14","cvss":7.5}},"context":{}}