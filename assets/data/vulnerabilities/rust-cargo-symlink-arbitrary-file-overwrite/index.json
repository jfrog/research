{"hash":"7f414c82e48769e4e59fbb5a58e6567b0629b963","data":{"post":{"title":"Rust Cargo symlink arbitrary file overwrite","path":"/vulnerabilities/rust-cargo-symlink-arbitrary-file-overwrite/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>A path traversal in Cargo leads to arbitrary file overwrite when a user downloads a malicious package from sources other than crates.io</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://github.com/rust-lang/cargo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Cargo</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>Rust (,1.63], fixed in Rust 1.64</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p><a href=\"https://github.com/rust-lang/rust\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Rust</a> uses <a href=\"https://github.com/rust-lang/cargo\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Cargo</a> as its package manager. Cargo, by default, downloads \"crates\" from <a href=\"https://crates.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">crates.io</a>. Crates are essentially TAR files compressed with GZip. Crates.io has several security tests to assure that a crate is safe to upload. One of the tests assures that none of the entries in the TAR file is a hard or soft link. These tests are good and work correctly.</p>\n<p>On the other hand, the Cargo client does not perform this test on crates that it downloads from the registry. Although it might be safe to assume that crates downloaded from crates.io are fine due to the tests mentioned above, crates downloaded from other sources cannot be assumed to be safe.</p>\n<p>After a package is downloaded, Cargo extracts its source code in the <code>~/.cargo</code> folder on disk, making it available to the Rust projects it builds. To record when an extraction is successful, Cargo writes the text <code>ok</code> to the <code>.cargo-ok</code> file at the root of the extracted source code once all files are extracted.</p>\n<p>Since the Cargo client does not check the package, it may contain a <code>.cargo-ok</code> symbolic link, which Cargo would extract. Then, when Cargo attempts to write <code>ok</code> into <code>.cargo-ok</code>, it would actually replace the first two bytes of the file the symlink points to with <code>ok</code>. This would allow an attacker to corrupt an arbitrary file on the machine that uses Cargo to extract the package.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>No PoC is supplied for this issue</p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>Users of alternate registries should exercise care in which packages they download, by only including trusted dependencies in their projects.</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://blog.rust-lang.org/2022/09/14/cargo-cves.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(Rust) Security advisories for Cargo (CVE-2022-36113, CVE-2022-36114)</a></p>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2022-36113\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2022-36113 Low severity. A path traversal in Cargo leads to arbitrary file overwrite.","date_published":"2022-09-14","xray_id":"","vul_id":"CVE-2022-36113","severity":"low","discovered_by":"Ori Hollander","last_updated":"2022-09-14","cvss":4.6}},"context":{}}