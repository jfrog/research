{"hash":"dade17d626aa660990862054a77e8b685c6ef585","data":{"post":{"title":"H2 console JNDI RCE","path":"/vulnerabilities/h2-console-jndi-rce-xray-193805/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>Unsafe JNDI loading in H2 database console leads to remote code execution</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://www.h2database.com/html/main.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">H2 Database</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>H2 Database (, 2.0.204], fixed in 2.0.206</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>Several code paths in the <a href=\"https://www.h2database.com/html/main.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">H2 database</a> framework pass unfiltered attacker-controlled URLs to the <code>javax.naming.Context.lookup</code> function, which allows for remote codebase loading.</p>\n<p>The most severe attack vector of this issue is through the H2 console.</p>\n<p>The H2 database contains an embedded web-based console, which allows easy management of the database. It’s available by default on <a href=\"http://localhost:8082\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:8082</a> when running the H2 package JAR.</p>\n<p>Access to the console is protected by a login form, which allows passing the <code>driver</code> and <code>url</code> fields to the corresponding fields of <code>JdbcUtils.getConnection</code>. This leads to unauthenticated RCE, since the username and password are not validated before performing the lookup with the potentially malicious URL.</p>\n<p>Although the issue is critical, it does have some mitigating factors -\n1. On vanilla distributions of the H2 database, by default the H2 console only listens to localhost connections – making the default setting safe.\n2. Many vendors may be running the H2 database, but not running the H2 console. Although there are other vectors to exploit this issue other than the console, these other vectors are context-dependent and less likely to be exposed to remote attackers.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>No PoC is supplied for this issue</p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>Vendors may wish to upgrade their Java (JRE/JDK) version to enable the <code>trustURLCodebase</code> mitigation.\nThis mitigation is enabled by default on the following versions of Java (or any later version) –</p>\n<ul>\n<li>6u211</li>\n<li>7u201</li>\n<li>8u191</li>\n<li>11.0.1</li>\n</ul>\n<p>The mitigation will deny loading of remote classes via JNDI, but can be bypassed by sending a serialized \"gadget\" Java object through LDAP, as long as the respective \"gadget\" class is included in the classpath (depends on the server that runs the H2 database).</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://jfrog.com/blog/the-jndi-strikes-back-unauthenticated-rce-in-h2-database-console/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">(JFrog) JNDI-Related Vulnerability Discovered in H2 Database Console </a></p>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2021-42392\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2021-42392 Critical severity. Unsafe JNDI loading in H2 database console leads to remote code execution","date_published":"2022-01-06","xray_id":"XRAY-193805","vul_id":"CVE-2021-42392","severity":"critical","discovered_by":"Andrey Polkovnychenko","last_updated":"2022-01-07","cvss":9.8}},"context":{}}