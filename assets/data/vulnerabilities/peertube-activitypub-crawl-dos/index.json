{"hash":"6925e7cc98205764ba2e182b767a4d088a4a5ef9","data":{"post":{"title":"PeerTube ActivityPub Crawl Infinite Loop DoS","path":"/vulnerabilities/peertube-activitypub-crawl-dos/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>This vulnerability allows any attacker to cause the server to stop responding to requests due to an infinite loop.</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://github.com/Chocobozzz/PeerTube\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PeerTube</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>(, 7.1.0]</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>If federation is enabled (which is the default), PeerTube listens for POST requests to the <strong>/inbox</strong> path. This path is used for receiving ActivityPub activities. The function <strong>crawlCollectionPage</strong> is in charge of iterating through an ActivityPub OrderedCollection object that is sent to the server. Ordered collections may be separated into pages. If the ordered collection has the <strong>first</strong> property, the code fetches the first page, and then uses every page’s <strong>next</strong> property for fetching the next page. </p>\n<pre><code class=\"language-js\">const limit = ACTIVITY_PUB.FETCH_PAGE_LIMIT\nlet i = 0\nlet nextLink = firstBody.first\n\nwhile (nextLink &#x26;&#x26; i &#x3C; limit) {\n    let body: any\n\n    if (typeof nextLink === 'string') {\n      // Don't crawl ourselves\n      const remoteHost = new URL(nextLink).host\n      if (remoteHost === WEBSERVER.HOST) continue\n\n      url = nextLink\n\n      const res = await fetchAP&#x3C;ActivityPubOrderedCollection&#x3C;T>>(url)\n      body = res.body\n    } else {\n      // nextLink is already the object we want\n      body = nextLink\n    }\n\n    nextLink = body.next\n    i++\n    ...\n  }\n</code></pre>\n<p>This code is meant to iterate through the pages, up to a maximum amount of <strong>ACTIVITY_PUB.FETCH_PAGE_LIMIT</strong> (2000) pages. When reaching a URL that has the same host as the server, the loop continues without incrementing the variable <strong>i</strong> or changing the <strong>nextLink</strong> variable. This means that the loop will never end. In our tests the server was busy running the endless loop and failed to respond to any other requests.</p>\n<p>It is also possible to trigger the attack by causing the server to actively fetch activities from a remote server. This can be done in different ways, for example by using the <strong>/api/v1/search/video-channels</strong> path, and passing the <strong>search</strong> argument with a URL that can be used for the attack. This can be done only if users have the ability to search remote URIs (<strong>search.remote_uri</strong> in the configuration), which by default is enabled for registered users.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>This PoC assumes that there is a PeerTube instance on the machine listening on ports 3000 (client) and 9000 (server). We also assume that there is a channel called <strong>root_channel</strong>, belonging to the root user. For simplifying the PoC, we set the <strong>prevent_ssrf</strong> configuration to <strong>false</strong>, allowing us to create an attacking server easily on the same machine. Note that running this PoC will cause PeerTube’s server to stop responding, and it will need to be killed.</p>\n<ol>\n<li>\n<p>In a terminal, run the following command (you will need to install the <strong>flask</strong> package for python if it is not installed on the system):</p>\n<pre><code>python malicious_rest_server.py\n</code></pre>\n<p>This will start a server listening on port 1234.</p>\n</li>\n<li>\n<p>In another terminal, run the following command (you will need to install the <strong>cryptography</strong> and <strong>requests</strong> packages for python if they are not installed on the system):</p>\n<pre><code>python send_inbox_activity.py --stuck\n</code></pre>\n<p>This script will create, sign and send a Create Activity to <strong><a href=\"http://localhost:9000/inbox\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:9000/inbox</a></strong>.</p>\n</li>\n<li>If everything was configured correctly, the PeerTube server won’t function normally anymore.</li>\n</ol>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://github.com/Chocobozzz/PeerTube/releases/tag/v7.1.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fix release</a></p>\n<p><a href=\"https://drive.google.com/file/d/1zmXFNutT4ACOJZGmxhU22nhu9Fbn4ui2/view?usp=drive_link\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PoC Materials</a></p>\n","description":"CVE-2025-32947 High severity. PeerTube ActivityPub Crawl Infinite Loop DoS","date_published":"2025-04-14","xray_id":"","vul_id":"CVE-2025-32947","severity":"high","discovered_by":"Ori Hollander","last_updated":"2025-04-14","cvss":7.5}},"context":{}}