{"hash":"86caac7b8304675776efe20b6cea06852575824a","data":{"post":{"title":"PeerTube Arbitrary Playlist Creation via ActivityPub Protocol","path":"/vulnerabilities/peertube-arbitrary-playlist-creation-activitypub/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>This vulnerability allows any attacker to add playlists to a different user’s channel using the ActivityPub protocol.</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://github.com/Chocobozzz/PeerTube\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PeerTube</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>(, 7.1.0]</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>If federation is enabled (which is the default), PeerTube listens for POST requests to the <strong>/inbox</strong> path. This path is used for receiving ActivityPub activities. One of the possible activities is the Create Activity, which creates different objects on the server. One of the objects that may be created is a playlist. The <strong>createOrUpdateVideoPlaylist</strong> function is in charge of creating the playlist. In it, the <strong>setVideoChannel</strong> function is called to set the video channel that the playlist will belong to:</p>\n<pre><code class=\"language-js\">async function setVideoChannel (playlistObject: PlaylistObject, playlistAttributes: AttributesOnly&#x3C;VideoPlaylistModel>) {\n  ...\n\n  const actor = await getOrCreateAPActor(getAPId(playlistObject.attributedTo[0]), 'all')\n\n  ...\n\n  playlistAttributes.videoChannelId = actor.VideoChannel.id\n  playlistAttributes.ownerAccountId = actor.VideoChannel.Account.id\n}\n</code></pre>\n<p>This code sets the owner of the new playlist to be the user who performed the request, and then sets the associated channel to the channel ID supplied by the request, without checking if it belongs to the user. This will allow any user to create a playlist in any existing channel on the server. The playlist will be owned by the attacking user, thus only the attacking user will be able to add and remove videos or change the properties of the playlist, while it will be listed in the web interface as belonging to a different user’s channel.</p>\n<p>This code sets the channel ID of the playlist to the channel ID from the <strong>attributedTo</strong> attribute of the Playlist object passed in the Create Activity without checking if the channel is owned by the actor who signed the activity or belongs to the server that the activity came from. It then sets the owner of the playlist to the owner of the channel. This will allow any attacker to create a playlist in any existing channel on the server. The playlist will be owned by the attacked user, thus the attacked user will be able to add and remove videos or change the properties of the playlist, but as long as the attacked user didn’t notice the attack, the playlist will be listed in its channel.</p>\n<p>It is also possible to trigger the attack by causing the server to actively fetch activities from a remote server. This can be done in different ways, for example by using the <strong>/api/v1/search/video-channels</strong> path, and passing the <strong>search</strong> argument with a URL that can be used for the attack. This can be done only if users have the ability to search remote URIs (<strong>search.remote_uri</strong> in the configuration), which by default is enabled for registered users.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>This PoC assumes that there is a PeerTube instance on the machine listening on ports 3000 (client) and 9000 (server). We also assume that there is a channel called <strong>root_channel</strong>, belonging to the root user. For simplifying the PoC, we set the <strong>prevent_ssrf</strong> configuration to <strong>false</strong>, allowing us to create an attacking server easily on the same machine.</p>\n<ol>\n<li>Edit the file <strong>malicious_rest_server.py</strong>. There is a commented out line that says “INSERT VIDEO HERE”. Under that line, replace the URL with a url of a valid video on the PeerTube server. You can find one by surfing to <a href=\"http://localhost:3000/api/v1/videos\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><strong>http://localhost:3000/api/v1/videos</strong></a> and copying the URL of one of the public videos.</li>\n<li>\n<p>In a terminal, run the following command (you will need to install the <strong>flask</strong> package for python if it is not installed on the system):</p>\n<pre><code>python malicious_rest_server.py\n</code></pre>\n<p>This will start a server listening on port 1234.</p>\n</li>\n<li>\n<p>In another terminal, run the following command (you will need to install the <strong>cryptography</strong> and <strong>requests</strong> packages for python if they are not installed on the system):</p>\n<pre><code>python send_inbox_activity.py\n</code></pre>\n<p>This script will create, sign and send a Create Activity to <strong><a href=\"http://localhost:9000/inbox\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:9000/inbox</a></strong>.</p>\n</li>\n<li>If everything was configured correctly, a new playlist will be created in <strong>root_channel</strong>, containing one video, and with a picture of a cat as the playlist’s thumbnail.</li>\n</ol>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://github.com/Chocobozzz/PeerTube/releases/tag/v7.1.1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fix release</a></p>\n<p><a href=\"https://drive.google.com/file/d/1zmXFNutT4ACOJZGmxhU22nhu9Fbn4ui2/view?usp=drive_link\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">PoC Materials</a></p>\n","description":"CVE-2025-32946 Medium severity. PeerTube Arbitrary Playlist Creation via ActivityPub Protocol","date_published":"2025-04-14","xray_id":"","vul_id":"CVE-2025-32946","severity":"medium","discovered_by":"Ori Hollander","last_updated":"2025-04-14","cvss":5.3}},"context":{}}