{"hash":"3e37f48cae46632e9beb96775992b5a34246862a","data":{"post":{"title":"Realtek multiple Wi-Fi modules RCE","path":"/vulnerabilities/realtek-multiple-wi-fi-modules-rce-xray-194071/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>A stack buffer overflow in Realtek Wi-Fi modules allows attackers in wireless range to perform arbitrary code execution by impersonating a Wi-Fi access point</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://www.amebaiot.com/en/ameba-sdk-summary/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Realtek Ameba SDK</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>Ameba SDK (, 2.0.8), fixed in 2.0.8</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p>Realtek Wi-Fi chips enable connectivity for embedded devices and are widely used in IoT development boards and production devices. Code running on the Realtek SoC handles some of the logic, including the handling for cryptographic keys. This vulnerability affects the RTL8195AM, RTL8711AM, RTL8711AF, and RTL8710AF modules. Attackers who know the correct password for the Wi-Fi network can exploit the modules by impersonating the Access Point (AP) and injecting a packet to cause a stack buffer overflow. The exploit can simply crash the device, causing denial of service, or attackers can also craft a packet which decrypts to an executable code payload, achieving arbitrary code execution. The firmware employs no mitigations against memory corruption attacks, such as stack canaries, the NX bit, or ASLR protections. Since this is a Wi-Fi attack, the attacker must be close enough to the attacked device to connect to their AP. The <code>DecWPA2KeyData</code> function in the module's firmware calls one of two vulnerable functions, depending on the access point's encryption algorithm: <code>_rt_arc4_crypt_veneer</code> or <code>_AES_UnWRAP_veneer</code>. Both functions decrypt a key buffer received from the AP and place the results into a fixed-size buffer on the stack without checking the actual buffer length. Since the attacker who impersonates the AP can craft an EAPOL-Key response packet with the key buffer's contents and length of their choice, they can cause stack buffer overflow. An attacker who knows the network's password can also compute the KEK (Key Encryption Key), which is derived from the Wi-Fi password. This allows the attacker to correctly encrypt a binary buffer using the KEK and pass the results in the key buffer, causing the device to decrypt it and overwrite its stack with attacker-controlled contents. This leads to malicious code execution. The original exploit was discovered by the JFrog Research Team. The fix adds an output length parameter to the vulnerable functions and verifies it against the maximum length of the key buffer.</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>No PoC is supplied for this issue</p>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability mitigations</a></h2>\n<p>No vulnerability mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://jfrog.com/blog/major-vulnerabilities-discovered-and-patched-in-realtek-rtl8195a-wi-fi-module/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">JFrog Blogpost</a></p>\n","description":"CVE-2020-9395 High severity. A stack buffer overflow in Realtek Wi-Fi modules allows attackers in wireless range to perform arbitrary code execution by impersonating a Wi-Fi access point","date_published":"2021-02-03","xray_id":"XRAY-194071","vul_id":"CVE-2020-9395","severity":"high","discovered_by":"Uriya Yavnieli","last_updated":"2021-02-03","cvss":8}},"context":{}}