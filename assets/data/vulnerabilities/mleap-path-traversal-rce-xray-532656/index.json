{"hash":"a66d2e1545f1e9e0db449b508bc6e185ab480cd6","data":{"post":{"title":"MLeap Path Traversal RCE","path":"/vulnerabilities/mleap-path-traversal-rce-xray-532656/","content":"<h2 id=\"summary\"><a href=\"#summary\" aria-hidden=\"true\" tabindex=\"-1\">Summary</a></h2>\n<p>Using MLeap for loading a saved model (zip archive) can lead to path traversal/arbitrary file creation and possibly remote code execution.</p>\n<h2 id=\"component\"><a href=\"#component\" aria-hidden=\"true\" tabindex=\"-1\">Component</a></h2>\n<p><a href=\"https://mvnrepository.com/artifact/ml.combust.mleap/mleap-tensorflow\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">ml.combust.mleap.mleap-tensorflow</a></p>\n<h2 id=\"affected-versions\"><a href=\"#affected-versions\" aria-hidden=\"true\" tabindex=\"-1\">Affected versions</a></h2>\n<p>[0.18.0,0.23.0], Fixed in 0.23.1</p>\n<h2 id=\"description\"><a href=\"#description\" aria-hidden=\"true\" tabindex=\"-1\">Description</a></h2>\n<p><code>FileUtil.extract()</code> enumerates all zip file entries and extracts each file without validating whether file paths in the archive are outside the intended directory.</p>\n<p>When creating an instance of <code>TensorflowModel</code> using the <code>saved_model</code> format and an exported TensorFlow model, the <code>apply()</code> function invokes the vulnerable implementation of <code>FileUtil.extract()</code>.</p>\n<p>Arbitrary file creation can directly lead to code execution</p>\n<h2 id=\"poc\"><a href=\"#poc\" aria-hidden=\"true\" tabindex=\"-1\">PoC</a></h2>\n<p>Example of a vulnerable usage of MLeap -</p>\n<pre><code class=\"language-scala\">package example\n\nimport ml.combust.mleap.core.types._\nimport ml.combust.mleap.tensor.Tensor\nimport ml.combust.mleap.tensorflow.TensorflowModel\nimport org.tensorflow\n\nimport java.nio.file.{Files, Paths}\n\nobject LoadModelFromZip extends App {\n  // Read zip file\n  def readZipFileAsByteArray(filePath: String): Array[Byte] = {\n    val fileBytes = Files.readAllBytes(Paths.get(filePath))\n    fileBytes\n  }\n  // Stub \n  val _file = \"/models/malicious.zip\"\n  val modelAsBytes = readZipFileAsByteArray(_file)\n  // Create a model from zip file\n  val model = TensorflowModel(\n        inputs = Seq(\n          (\"InputA\", TensorType.Float()), (\"InputB\", TensorType.Float())\n        ),\n        outputs = Seq((\"MyResult\", TensorType.Float())),\n        format = Option(\"saved_model\"),\n        modelBytes = modelAsBytes\n      )\n  // Invoke FileUtil.extract()\n  model.apply(Tensor.create(Array(2.0, 1.0, 34.0), Seq(-1)))\n}\n</code></pre>\n<h2 id=\"vulnerability-mitigations\"><a href=\"#vulnerability-mitigations\" aria-hidden=\"true\" tabindex=\"-1\">Vulnerability Mitigations</a></h2>\n<p>No mitigations are supplied for this issue</p>\n<h2 id=\"references\"><a href=\"#references\" aria-hidden=\"true\" tabindex=\"-1\">References</a></h2>\n<p><a href=\"https://github.com/combust/mleap/pull/866#issuecomment-1738032225\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Fixing PR</a></p>\n","description":"CVE-2023-5245, MEDIUM, Using MLeap for loading a saved model (zip archive) can lead to path traversal/arbitrary file creation and possibly remote code execution.","date_published":"2023-11-15","xray_id":"XRAY-532656","vul_id":"CVE-2023-5245","severity":"medium","discovered_by":"David Fadida","last_updated":"2023-11-15","cvss":7.5}},"context":{}}