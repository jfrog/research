<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>GGUF-SSTI - JFrog Security Research</title><meta name="gridsome:hash" content="00b8e4775ceabedad0345ab7ab1357383b9cd0f9"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="referrer" content="origin"><meta data-vue-tag="ssr" http-equiv="Content-Security-Policy" content="default-src *  &#x27;self&#x27; &#x27;unsafe-eval&#x27; &#x27;unsafe-inline&#x27;  https://jfrog.com; img-src &#x27;self&#x27; * data: ; font-src &#x27;self&#x27; * data: ;"><meta data-vue-tag="ssr" name="title" content="GGUF-SSTI"><meta data-vue-tag="ssr" name="description" content="GGUF model attempting template injection for arbitrary code execution"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.ebe1c983be3d8af04d6186b36f13b87c.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.ebe1c983be3d8af04d6186b36f13b87c.png"><link rel="preload" href="/assets/css/0.styles.0a1365b2.css" as="style"><link rel="preload" href="/assets/js/app.1adfd395.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--model-threats-post-vue.ecc53922.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.9f141ac9.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.3a995ca3.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue~page--src--pages--malicious-packages-vue.e2950186.js"><link rel="prefetch" href="/assets/js/page--src--pages--malicious-packages-vue.20041e6d.js"><link rel="prefetch" href="/assets/js/page--src--pages--model-threats-vue.c821cb1b.js"><link rel="prefetch" href="/assets/js/page--src--pages--oss-vue.8664726d.js"><link rel="prefetch" href="/assets/js/page--src--pages--post-vue.983fc590.js"><link rel="prefetch" href="/assets/js/page--src--pages--vulnerabilities-vue.e3faf883.js"><link rel="prefetch" href="/assets/js/page--src--templates--post-vue.d2ee2512.js"><link rel="prefetch" href="/assets/js/page--src--templates--real-time-post-vue.61fe1036.js"><link rel="prefetch" href="/assets/js/vendors~page--src--pages--index-vue.2ec3d7ff.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--model-threats-post-vue~page--src--templates--real-time-post-vue.7f393094.js"><link rel="prefetch" href="/assets/js/vendors~page--src--templates--real-time-post-vue.114325c7.js"><link rel="stylesheet" href="/assets/css/0.styles.0a1365b2.css"><script data-vue-tag="ssr" src="/speedsize-local.js"></script><script data-vue-tag="ssr" src="https://transcend-cdn.com/cm/f0071674-c641-4cf3-9d31-303ec0c86b1b/airgap.js" data-languages="en" data-tracker-overrides="GoogleConsentMode:security_storage=on;ad_storage=SaleOfInfo,Advertising;ad_user_data=SaleOfInfo,Advertising;ad_personalization=SaleOfInfo,Advertising;analytics_storage=Analytics,SaleOfInfo;functionality_storage=Functional,SaleOfInfo;personalization_storage=Functional,SaleOfInfo" data-cfasync="false" type="text/javascript" charset="utf-8"></script><script data-vue-tag="ssr" type="text/javascript" charset="utf-8">
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "GTM-T6MF8M");
      gtag('set', 'developer_id.dODQ2Mj', true);
    </script><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><header class="py-2 main-header"><div class="container mx-auto px-2"><div class="flex w-full justify-between items-center"><div class="left"><div class="flex items-center gap-2"><a href="/" class="logo active"><img alt="JFrog Security Research" src="/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg" width="40" srcset="/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg 40w" sizes="(max-width: 40px) 100vw, 40px" class="g-image"></a><span class="site-name small">JFrog Security Research</span></div></div><div class="right"><div class="hidden sm:block desktop-menu-wrapper"><ul class="top-menu flex items-center"><li class="menu-item"><a href="/model-threats/" class="font-bold px-3 active">
      Model Threats
    </a><a href="/vulnerabilities/" class="font-bold px-3 mx-3">
      Discover
    </a></li><li><a href="https://twitter.com/JFrogSecurity" target="_blank" rel="noreferrer noopener noreferrer" class="sr-button px-3 py-2 inline-flex gap-2">
  Follow JFrog Security
  <img alt="twitter" src="/assets/static/twitter.e0519be.9769aec62433fd58c76ad32c2d613842.svg" width="14" srcset="/assets/static/twitter.e0519be.9769aec62433fd58c76ad32c2d613842.svg 14w" sizes="(max-width: 14px) 100vw, 14px" class="g-image"></a></li></ul></div><div class="sm:hidden flex item-center mobile-menu-wrapper gap-2"><!----><button class="show-menu-hamburger px-1"><img alt="Menu" src="/assets/static/hamburger.a58a0fd.dc5087fee70346d455e75c87bc430716.svg" width="22" srcset="/assets/static/hamburger.a58a0fd.dc5087fee70346d455e75c87bc430716.svg 22w" sizes="(max-width: 22px) 100vw, 22px" class="g-image"></button></div></div></div></div><div class="fixed mobile-menu h-screen w-screen z-50 bg-white text-gray-700 p-5 inset-0" style="display:none;"><div class="flex justify-end mb-3"><button class="p-3"><img alt="Menu" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 12 12' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-ed66a5bf1eb83ec14d27c7d6a4278d79'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-ed66a5bf1eb83ec14d27c7d6a4278d79)' width='12' height='12' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAsTAAALEwEAmpwYAAAJfklEQVR42u2bCWwVVRSGpwtQWpa2UFpkEWRvUQFBNEqkFMoiIogKFWsFKiAYTTBRoiwulD0KERLBoKAiZRN3UCEiUUBFRWURBFxABCn70va1FM99fhOuw8xjmzd9yXOSP236%2bmbO%2bp9zz71jGOdf8YIWgk6CewU5gvsEPQRtBfUFVQUVjNC6KiBXfeTsgdw56NEJveIvdKNqgmaCdME9gmxBf0E3QRtBXUGcICrEDBCFXHWRsxtyZ6NHOnpVu9CNEgSpgs7cYKDgfkFPQXtBQ6xYSRAZIspHIk888rVH3vuRvz/6pKKf4xUjqCNoJ7hTkCt4VDBcMEDQVdBa0EBQS1BdUJnwiywHpSvw/OrI0wD5uiLvcOTPRZ926BdjzXl1g0Q%2bbCW4XTBUMEYwSZAnGCUYIugj6EiYNRGkkHvRHhsgmuemIEcb5OqDnKOQexJ6DEWvVuiZiN5%2bYmguSMNC6p%2bG8eVXBYsFiwSvCV4UPC14WNAPYmkpSBZU9NgAlVC%2bJXL0Qy4l3wvIuwj556LPMPRrh75KbyMDgugi6I2lJggWCNYIvhN8L9gg%2bESQL5gpGCcYzPcbQ0BeXlXwfAZyjEOufORcj9xK/s/QJw/9eqOv0ttvOVUmsgQPCcbieaX8TkGB4KjgoOA3wSbBKsGbgufINWXRJEGEh/mfxHMHIMebyLUJOQ8idwF6rEGvseiZRXUwHhQ8IBgkeEwwWbAEy6kvn9Xg4287BJ8TWo8LuguaklPRHuR%2bdZ7XnefPRZ4dyOezyF2APkvQ7zH0VXr7m4Us6uVwwn8x4XPUciOFUqy7RfC%2bYBoWzSCv6kCslV1slqI1tr%2bKctYJdp%2bGHFuQq9RG5mNExmL0G4G%2bSm9/x6SahjsIp1EQyAZueNYGhYK9gq8gmkkQkGLgWyAXRVCxLhkghjKnvH4zJc3kqnzk2ItcdvIe4n/mCZ6iP%2bhFBPnbxjY0D5l4U7Hox%2bSSz%2baGZ4iO3YJ1gmUQ0NM0Hp2pLoku8YIZ8ul4TjlpBiH9BTl%2bBLnsZN0DP8ygEnTDkEp3f%2b9cR2si%2bqDIQtJARUGJzY2LBIcFv2vEuACvKCN0ENRzoTyqFrc2Aivln8WTKwUbcUIB8th5XznqJ4ylCPBuFG%2bE7v5yEouVrxbchpVeEnwq2I4RTlvyq4zoOMXnO4mGBTQefQXXEgWXS4wRyNWCkB2F8orwtgn%2bEhwXFNt4v5io2EUFeFnwCNxxDXJVNQkmEk8lEQX3Yq03%2bPJmwugIeWZ9WAmfKSOsFsziYZkIn8IiJIbnRQRQOApZVF9Rk1qfTs5PF6xA%2bYPIUmZxSjFGUcb5WfAlPPE8hN8OeSpbHROBkI154CDC7RXBe5Ci2RcU24RaCUL9IFgumEokKXK9iRxOIeIiAxggFkc0IlS70eiY1WkjyhU6yKAc8Sv/t4KImUB73IUVYbxTVMYgZBqhoiw2EmUWQji7sXCZjQAqHf6AcZfhsSept525b1KAlIgkNJvR12dpz8/Xnn8swPN/x1lLad2f4PkqGq%2bjjMY6RaE5VEgmEnQP5F2CB1T1%2bBaims93c4mshoSf3VURYurAIOMZIvD9i4hAHxGoCPltwRTSpicR2AwyrRaImCPxjl0ODsGjKy8yB/dDoGYOPsu6vDX3jXKYRl0LgY4WvK5x0N4AHOTTOGgVHDSCkG%2bOQ6sS4Ze0dL9cFjYNcRgWVv8/hxY0E2/UwsiViIhE8j6dpmomyigi%2b9uhCpU4VCFlvLtYKSZc6fTqYuuwU0ocwoPv0IfnMrBoj7dbwA03wDsqX8dTt1UfcsChxptl7g%2bI19qH3Mp4zJV23K4Tmw4n6J1YqUPbvEfzzkRtMZJFye2H4sNZ2SneWAubn7S5ZxmR9xvcsJywH23pRBPcWoFZe/Fell58Azl62mHxdBg%2bWItnZ8PQk7nHRJhehf1b9BJbCW2fg/f3Q7RLIbwRhP2tWu/h1lrET4wxREJtHpBOdZgKS28mV4tsvFXIZ2q5%2bg0DCrXW%2bIAeQ%2bFDOs91KP8X%2bW3XdJkGXUEkDoPwWhL2CSgflNF9FIZoQokcSalaA2EdIGx9mvClKFNAzv4CiW6mT/%2bR37fBKeoeJ7Q1SBn3KIRTdlFd5lHne8L2CV7tV0RQytqSx89QslZBXL%2bi7CmUOMPP09p06QBhrDy9D%2bxHwROaAU3FD8Mlm6kqC%2bkvsiHUZK/3KuIoWx1pWkZDREvJdTOMTWVK%2bFmIYU6CExCaiVOkUYlW5v4m5NdRTWZTjcyZZBNzYePlZS6emtO59YXFx8PiJpGZKVGMAYq1333a34owTpH299OWEdwChi%2bPUjk6Mh1Kpp/wfCsqlgamPjU9nWh4DjZfTzoc0jzr09KiTEOpxSCFpMseiHMJFWMwhNeKGUZNotHrfQk/D0RoS%2bl4UiKDSJgFq28jt4%2bjlM%2bhXzDJsgQDnLJMdGdrnaQqxzWoTFHIEGGEwJVIR5dNefwAlt%2bHAYoCKK%2bPsPQWdztz/uk0T%2b1JvVDZlzyvYUqlu1MM/S5t6p8sYYsd5nZ2kWCSn4qgjzDoAJa0cUaIXhVY6PSFDN9heaoboOwSDbCVJmkyq8k06%2bZmOEZAlVA1gFccUMsIgQMaXlcBc57QlTSrqQ02y6UKlEcfMJE%2bIJPJUkMqQpXy6AO87gTX0glOphPsj8HT6AQ9J0av1wI7tLXAHNYCuQw/mhoXcfgplFaDBS6sBvOpNA8w9U3xKg1CaR4wn32HO7TN2IrBIMRgTIRWujARWqlNhDIh4noYwtWJkFszwc8ZpLo5E1zGd0dAxB2CMRN0cyo8ARYfaJw7p3MlU%2bGvtKnwGJqlLoaL5xPc3BeYpNXxGxliNrfsC%2bRc5r7Aas3AgwyXzie4uTM0G893IZqSCNGKQdgZuuzzCcHaG1xI5PSjg6vhsJ53Y29wtWVv0Ho%2bIeDeoNu7w%2bb%2bfB736Ej7GhPE3WHzfMIU47/nE5qxNV49UFq4dT7A3J%2bfztw%2bm0VSKlHl1fkA83xCDrxzvfHveag4uyhw%2b4SI6QHzmH0TIivO8PaEyHzj3AmRTMsGSoRhuH9GKND%2bfCWjfM8Imcd6a%2buNUjBOibm1Px%2bMU2IZRFcNcwHl9jnBPMPd/flgnRNsjMOv%2bKToesP5pKhb%2b/NunxTtbmgnRa/krPDXhvNZ4WQj9M4KK0J8CiP2Qvf/T4uH/fsC4fLGyGfoNcawvDES9u8Mhf1bY%2bHy3uAQw%2bG9QWu5Cbs3R61XWL87bBhh9vb4P/%2bX4wkCBpt7AAAAAElFTkSuQmCC' /%3e%3c/svg%3e" width="12" data-src="/assets/static/close.5cd2673.91b568c73f917f773ea7915d69802829.svg" data-srcset="/assets/static/close.5cd2673.91b568c73f917f773ea7915d69802829.svg 12w" data-sizes="(max-width: 12px) 100vw, 12px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/close.5cd2673.91b568c73f917f773ea7915d69802829.svg" class="g-image g-image--loaded" width="12" alt="Menu"></noscript></button></div><ul class="mobile-menu-list"><li class="py-4 px-2 border-t border-gray-200"><a href="/" class="text-gray-700 active">
        Home
      </a></li><li class="py-4 px-2 border-t border-gray-200"><a href="/model-threats/" class="text-gray-700 active">
        Model Threats
      </a></li><li class="py-4 px-2 border-t border-gray-200"><a href="/vulnerabilities/" class="text-gray-700">
        Discover
      </a></li><li class="py-4 px-2 border-t border-gray-200"><a href="https://twitter.com/JFrogSecurity" target="_blank" rel="noopener" class="text-gray-700">
        Follow JFrog Security
      </a></li></ul></div></header><div class="container mt-posts pt-5 pb-10"><a href="/model-threats/" class="hover:text-jfrog-green transition-all active">
      &lt; Back
    </a><div class="mt-posts-details"><div id="main-title" class="title">GGUF-SSTI</div><div class="description mb-3">GGUF model attempting template injection for arbitrary code execution</div><button class="modal-btn"><span>
        Explore more info
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.61158 8.00418L5.48844 4.12549C5.39748 4.04009 5.34893 3.93527 5.34278 3.81104C5.33647 3.68697 5.38502 3.57636 5.48844 3.47923C5.5917 3.38195 5.7062 3.33331 5.83196 3.33331C5.95771 3.33331 6.07221 3.38195 6.17547 3.47923L10.437 7.48763C10.5216 7.5674 10.5811 7.64885 10.6154 7.73197C10.6496 7.81509 10.6666 7.90583 10.6666 8.00418C10.6666 8.10252 10.6496 8.19326 10.6154 8.27638C10.5811 8.3595 10.5216 8.44095 10.437 8.52073L6.17547 12.5291C6.08467 12.6147 5.97325 12.6603 5.84118 12.6661C5.70928 12.6721 5.5917 12.6264 5.48844 12.5291C5.38502 12.432 5.33331 12.3243 5.33331 12.206C5.33331 12.0877 5.38502 11.98 5.48844 11.8829L9.61158 8.00418Z" fill="#3EB065"></path></svg></span></button></div><div class="mt-posts-content"><nav class="post-content-menu"><ul></ul></nav><section class="single-post-content mt-single-post-content mt-3 py-5 sm:py-8 px-4 sm:px-10 text-black border-black border-b text-xs"><h2 id="overview"><a href="#overview" aria-hidden="true" tabindex="-1">Overview</a></h2>
<p>A GGUF model may contain a <a href="https://palletsprojects.com/projects/jinja/" target="_blank" rel="nofollow noopener noreferrer">Jinja2</a> template which may cause server-side template injection (<a href="https://portswigger.net/web-security/server-side-template-injection" target="_blank" rel="nofollow noopener noreferrer">SSTI</a>) that leads to <strong>execution of malicious Python code</strong> when the model is loaded.</p>
<p><u>Important Note</u> - The only publicly known case where loading a GGUF model leads to dangerous server-side template injection is related to the <a href="https://github.com/abetlen/llama-cpp-python/security/advisories/GHSA-56xg-wfcc-g829" target="_blank" rel="nofollow noopener noreferrer">CVE-2024-34359</a> ("Llama Drama") vulnerability. This vulnerability is only exploitable when loading a GGUF model using a vulnerable version of the <a href="https://pypi.org/project/llama-cpp-python/" target="_blank" rel="nofollow noopener noreferrer">llama-cpp-python</a> library (<code>llama-cpp-python</code> &#x3C; 0.2.72). This means that arbitrary code execution <u>will not occur</u> when loading a malicious GGUF model into <code>llama-cpp-python</code> >= 0.2.72 or into other GGUF-compatible libraries, such as <a href="https://ollama.com/download" target="_blank" rel="nofollow noopener noreferrer">ollama</a> .</p>
<p>The GGUF model format is a binary format optimized for quickly loading and storing models. One of the features of the GGUF model format, is the ability to store a <strong>chat template</strong> in the Model's metadata (<code>tokenizer.chat_template</code>).</p>
<p><img src="/img/chat_template.png"></p>
<p>A chat template simply defines how a chat (prompt) interaction with the model will look like. The chat template in a GGUF model is written using the Jinja2 template language. Since the Jinja2 template language supports execution of arbitrary Python code, loading arbitrary Jinja2 templates from a GGUF model into an <strong>unsandboxed</strong> Jinja2 engine leads to arbitrary code execution.</p>
<p>For example - the following Jinja2 template, which can be inserted into a GGUF model's <code>chat_template</code> metadata parameter, will run the shell command <code>touch /tmp/retr0reg</code> if the GGUF model is loaded in an unsandboxed environment -</p>
<pre><code>{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("touch /tmp/retr0reg")}}{%endif%}{% endfor %}
</code></pre>
<h2 id="time-of-infection"><a href="#time-of-infection" aria-hidden="true" tabindex="-1">Time of Infection</a></h2>
<p><strong>[v] Model Load</strong></p>
<p>[] Model Query</p>
<p>[] Other</p>
<h2 id="evidence-extraction-and-false-positive-elimination"><a href="#evidence-extraction-and-false-positive-elimination" aria-hidden="true" tabindex="-1">Evidence Extraction and False Positive Elimination</a></h2>
<p>To safely determine if the suspected GGUF model contains a malicious Jinja2 template -</p>
<ol>
<li>Parse the GGUF model's metadata parameters and extract the <code>tokenizer.chat_template</code> string</li>
<li>Inspect the chat template data for suspicious strings such as <code>__class__</code>, <code>os</code>, <code>subprocess</code>, <code>eval</code> and <code>exec</code></li>
</ol>
<p>JFrog conducts metadata extraction and detailed analysis on each GGUF model in order to determine whether any malicious code is present.</p>
<h2 id="additional-information"><a href="#additional-information" aria-hidden="true" tabindex="-1">Additional Information</a></h2>
<ul>
<li><a href="https://github.com/abetlen/llama-cpp-python/security/advisories/GHSA-56xg-wfcc-g829" target="_blank" rel="nofollow noopener noreferrer">https://github.com/abetlen/llama-cpp-python/security/advisories/GHSA-56xg-wfcc-g829</a></li>
<li><a href="https://github.com/huggingface/smol-course/blob/main/1_instruction_tuning/chat_templates.md" target="_blank" rel="nofollow noopener noreferrer">https://github.com/huggingface/smol-course/blob/main/1_instruction_tuning/chat_templates.md</a></li>
<li><a href="https://techtonics.medium.com/secure-templating-with-jinja2-understanding-ssti-and-jinja2-sandbox-environment-b956edd60456" target="_blank" rel="nofollow noopener noreferrer">https://techtonics.medium.com/secure-templating-with-jinja2-understanding-ssti-and-jinja2-sandbox-environment-b956edd60456</a></li>
</ul>
</section></div><button class="modal-btn mt-5"><span>
        Explore more info
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.61158 8.00418L5.48844 4.12549C5.39748 4.04009 5.34893 3.93527 5.34278 3.81104C5.33647 3.68697 5.38502 3.57636 5.48844 3.47923C5.5917 3.38195 5.7062 3.33331 5.83196 3.33331C5.95771 3.33331 6.07221 3.38195 6.17547 3.47923L10.437 7.48763C10.5216 7.5674 10.5811 7.64885 10.6154 7.73197C10.6496 7.81509 10.6666 7.90583 10.6666 8.00418C10.6666 8.10252 10.6496 8.19326 10.6154 8.27638C10.5811 8.3595 10.5216 8.44095 10.437 8.52073L6.17547 12.5291C6.08467 12.6147 5.97325 12.6603 5.84118 12.6661C5.70928 12.6721 5.5917 12.6264 5.48844 12.5291C5.38502 12.432 5.33331 12.3243 5.33331 12.206C5.33331 12.0877 5.38502 11.98 5.48844 11.8829L9.61158 8.00418Z" fill="#3EB065"></path></svg></span></button></div><!----><footer class="py-4 main-footer bg-black"><div class="container mx-auto px-2"><div class="flex w-full justify-center flex-col sm:flex-row sm:justify-between items-center flex-wrap gap-4"><div class="left"><div class="flex items-center gap-2"><a href="/" class="logo active"><img alt="JFrog Security Research" src="/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg" width="40" srcset="/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg 40w" sizes="(max-width: 40px) 100vw, 40px" class="g-image"></a></div></div><div class="right"><ul class="footer-menu flex flex-col sm:flex-row items-center"><li class="px-4 py-1 sm:border-r"><a href="https://jfrog.com/terms-of-use/" rel="noopener noreferrer" target="_blank" class="text-white">
              Terms of Use
            </a></li><li class="px-4 py-1 sm:border-r"><a href="https://jfrog.com/jfrog-cookies-policy/" rel="noopener noreferrer" target="_blank" class="text-white">
              Cookies Policy
            </a></li><li class="px-4 py-1 sm:border-r"><a href="https://jfrog.com/privacy-policy/" rel="noopener noreferrer" target="_blank" class="text-white">
              Privacy Policy
            </a></li><li class="px-4 py-1 sm:border-r"><a href="#" rel="noopener noreferrer" target="_self" class="text-white ot-sdk-show-settings">
              Cookies Settings
            </a></li></ul></div></div><p class="sm:hidden text-center text-white pt-3">
      ©2025 All Rights Reserved. JFrog Ltd.
    </p></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"modelThreatsPost":{"title":"GGUF-SSTI","path":"\u002Fmodel-threats\u002Fgguf-ssti\u002F","content":"\u003Ch2 id=\"overview\"\u003E\u003Ca href=\"#overview\" aria-hidden=\"true\" tabindex=\"-1\"\u003EOverview\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cp\u003EA GGUF model may contain a \u003Ca href=\"https:\u002F\u002Fpalletsprojects.com\u002Fprojects\u002Fjinja\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EJinja2\u003C\u002Fa\u003E template which may cause server-side template injection (\u003Ca href=\"https:\u002F\u002Fportswigger.net\u002Fweb-security\u002Fserver-side-template-injection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ESSTI\u003C\u002Fa\u003E) that leads to \u003Cstrong\u003Eexecution of malicious Python code\u003C\u002Fstrong\u003E when the model is loaded.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cu\u003EImportant Note\u003C\u002Fu\u003E - The only publicly known case where loading a GGUF model leads to dangerous server-side template injection is related to the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fabetlen\u002Fllama-cpp-python\u002Fsecurity\u002Fadvisories\u002FGHSA-56xg-wfcc-g829\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003ECVE-2024-34359\u003C\u002Fa\u003E (\"Llama Drama\") vulnerability. This vulnerability is only exploitable when loading a GGUF model using a vulnerable version of the \u003Ca href=\"https:\u002F\u002Fpypi.org\u002Fproject\u002Fllama-cpp-python\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ellama-cpp-python\u003C\u002Fa\u003E library (\u003Ccode\u003Ellama-cpp-python\u003C\u002Fcode\u003E &#x3C; 0.2.72). This means that arbitrary code execution \u003Cu\u003Ewill not occur\u003C\u002Fu\u003E when loading a malicious GGUF model into \u003Ccode\u003Ellama-cpp-python\u003C\u002Fcode\u003E \u003E= 0.2.72 or into other GGUF-compatible libraries, such as \u003Ca href=\"https:\u002F\u002Follama.com\u002Fdownload\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Eollama\u003C\u002Fa\u003E .\u003C\u002Fp\u003E\n\u003Cp\u003EThe GGUF model format is a binary format optimized for quickly loading and storing models. One of the features of the GGUF model format, is the ability to store a \u003Cstrong\u003Echat template\u003C\u002Fstrong\u003E in the Model's metadata (\u003Ccode\u003Etokenizer.chat_template\u003C\u002Fcode\u003E).\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Cimg src=\"\u002Fimg\u002Fchat_template.png\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EA chat template simply defines how a chat (prompt) interaction with the model will look like. The chat template in a GGUF model is written using the Jinja2 template language. Since the Jinja2 template language supports execution of arbitrary Python code, loading arbitrary Jinja2 templates from a GGUF model into an \u003Cstrong\u003Eunsandboxed\u003C\u002Fstrong\u003E Jinja2 engine leads to arbitrary code execution.\u003C\u002Fp\u003E\n\u003Cp\u003EFor example - the following Jinja2 template, which can be inserted into a GGUF model's \u003Ccode\u003Echat_template\u003C\u002Fcode\u003E metadata parameter, will run the shell command \u003Ccode\u003Etouch \u002Ftmp\u002Fretr0reg\u003C\u002Fcode\u003E if the GGUF model is loaded in an unsandboxed environment -\u003C\u002Fp\u003E\n\u003Cpre\u003E\u003Ccode\u003E{% for x in ().__class__.__base__.__subclasses__() %}{% if \"warning\" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(\"touch \u002Ftmp\u002Fretr0reg\")}}{%endif%}{% endfor %}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"time-of-infection\"\u003E\u003Ca href=\"#time-of-infection\" aria-hidden=\"true\" tabindex=\"-1\"\u003ETime of Infection\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Cstrong\u003E[v] Model Load\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E[] Model Query\u003C\u002Fp\u003E\n\u003Cp\u003E[] Other\u003C\u002Fp\u003E\n\u003Ch2 id=\"evidence-extraction-and-false-positive-elimination\"\u003E\u003Ca href=\"#evidence-extraction-and-false-positive-elimination\" aria-hidden=\"true\" tabindex=\"-1\"\u003EEvidence Extraction and False Positive Elimination\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cp\u003ETo safely determine if the suspected GGUF model contains a malicious Jinja2 template -\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EParse the GGUF model's metadata parameters and extract the \u003Ccode\u003Etokenizer.chat_template\u003C\u002Fcode\u003E string\u003C\u002Fli\u003E\n\u003Cli\u003EInspect the chat template data for suspicious strings such as \u003Ccode\u003E__class__\u003C\u002Fcode\u003E, \u003Ccode\u003Eos\u003C\u002Fcode\u003E, \u003Ccode\u003Esubprocess\u003C\u002Fcode\u003E, \u003Ccode\u003Eeval\u003C\u002Fcode\u003E and \u003Ccode\u003Eexec\u003C\u002Fcode\u003E\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003EJFrog conducts metadata extraction and detailed analysis on each GGUF model in order to determine whether any malicious code is present.\u003C\u002Fp\u003E\n\u003Ch2 id=\"additional-information\"\u003E\u003Ca href=\"#additional-information\" aria-hidden=\"true\" tabindex=\"-1\"\u003EAdditional Information\u003C\u002Fa\u003E\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fabetlen\u002Fllama-cpp-python\u002Fsecurity\u002Fadvisories\u002FGHSA-56xg-wfcc-g829\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fabetlen\u002Fllama-cpp-python\u002Fsecurity\u002Fadvisories\u002FGHSA-56xg-wfcc-g829\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fhuggingface\u002Fsmol-course\u002Fblob\u002Fmain\u002F1_instruction_tuning\u002Fchat_templates.md\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fgithub.com\u002Fhuggingface\u002Fsmol-course\u002Fblob\u002Fmain\u002F1_instruction_tuning\u002Fchat_templates.md\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Ftechtonics.medium.com\u002Fsecure-templating-with-jinja2-understanding-ssti-and-jinja2-sandbox-environment-b956edd60456\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Ftechtonics.medium.com\u002Fsecure-templating-with-jinja2-understanding-ssti-and-jinja2-sandbox-environment-b956edd60456\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n","description":"GGUF model attempting template injection for arbitrary code execution"}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.1adfd395.js" defer></script><script src="/assets/js/page--src--templates--model-threats-post-vue.ecc53922.js" defer></script><script data-vue-tag="ssr" type="text/javascript" charset="utf-8" data-body="true">
    if (window.airgap) {
      const cookieSettings = document.getElementById('cookie_settings') || document.querySelector('.ot-sdk-show-settings');
      cookieSettings.href = "#";
      cookieSettings.target = "_self";
      cookieSettings.onclick = () => {
        transcend.showConsentManager({ viewState: 'CompleteOptions' });
      };
    }
  </script>
  </body>
</html>
